> https://www.techflowpost.com/article/detail_12574.html
>
> https://www.aixinzhijie.com/article/6783962

扩容的目的是为了：降低交易费用、提高吞吐、可扩展。

扩容的方案从本质讲只有两种：侧链和rollup。这两种方案在不同的特性上有自己权衡，从实现角度上最核心的差异是向主网提交区块头hash还是整个区块。

# 侧链

> https://ethereum.org/zh/developers/docs/scaling/sidechains/

侧链是一个独立的区块链，拥有独立的共识协议和算法，安全性由自身保证。这样侧链可以自己独立完成交易和验证。

侧链通过双向链桥（部署在主链和侧链上的智能合约）与主链连接实现价值传递，但是价值传递不代表实际价值的传递，而是在主侧链上通过铸币、销毁来实现。双向链桥的除了传递资产外，还可能传递合约状态、Merkle证明等。侧链上交易的正确性由自身负责。

与layer2方案不同，侧链不会将状态变化和交易数据发布到主链上，仅提交区块头hash。

### 类型

- EVM和非EVM兼容侧链

  EVM兼容是指根据EVM自定义实现的侧链，可以支持原生solidity合约部署。例如：Avalanche、Fantom、Celo

  非EVM侧链实现了不同的虚拟机架构（如go语言实现的VM），需要侧链提供额外的支持才能运行solidity合约。如：Solana 

- 提交链和Optimistic链

  区别在于，向主网提交的区块hash是否经过所有验证者验证。提交链需要经过大部分参与者验证才能提交，而Optimistic链由一个参与者提交，并在一个挑战窗口内接收其他参与者验证。

  要注意所有的验证都是在侧脸上，而主链无法验证。

#  rollup

比特币：闪电网络

以太坊：layer2（rollups，以太坊的扩容方案统称为layer2）

在二层网络中打包并执行大量交易，再将执行结果提交到以太坊，依靠以太坊的安全性保障交易的安全。rollups分为两种：optimistic rollups和 zero-knowledge rollups。

> 目前optimistic rollups可以被广泛使用，而zk是针对特定应用

## optimistic rollups

> https://ethereum.org/zh/developers/docs/scaling/optimistic-rollups/

在以太坊之外执行交易，并将计算和状态存储转移到链下，仅将交易数据作为calldata提交到主网。

在向主网提交交易时不对交易进行验证，但是在提交后保留一个“challenge period”来接收任何人对交易的质疑。

已经发布但是没有度过窗口期的交易叫做断言（assert），通过重放有争议的交易来验证断言。

## zero-knowledge rollups

> https://ethereum.org/zh/developers/docs/scaling/zk-rollups/

将交易打包并在链下执行，仅提交所有交易变化的摘要，同时生成有效性证明（validity proof，有效性证明允许参与方在不透露陈述本身的情况下证明陈述的正确性）。

zk rollups与optimistic rollups的区别在于，前者仅需提供validity proof即可确定最终交易。

zk rollups通过链下计算交易提升吞吐量，通过压缩数据实现扩容。相比乐观rollups，zk不用向主网发布所有关于交易的信息，仅需要账户和余额的状态信息。

架构包括：

1. 链上合约：存储卷叠区块、跟踪存款并监控状态更新的主合约；验证者合约
2. 链下虚拟机





## L1/L2互操作性



## 状态通道

状态通道是为了让参与者安全的进行链下的交易，同时最大程度减少与主链的交互。交易双方只需要在两条链上提交打开和关闭通道，可以极大提高主链的吞吐量。通道是对等协议，允许双发进行多笔交易，只将最终结果发布到区块链上。

## 支付通道

支付通道是参与方维护的双向账本。在参与方只需要在交易开始时建立交易通道，参与方的账户余额是建立通道时锁定在账户上的余额。支付通道建立后，参与方可以在多方批准的前提下执行多次交易，可以减少多次操作带来的交易成本（例如，以太币转账、原子交换、小额支付）。参与者可以在通道建立期间不限时、不限次数的执行交易。



## 状态通道





# 侧链与rollup的区别

- 提交内容

  侧链仅提交区块头信息

  rollup提交整个区块，包括交易数据和有效性证明

- 可用性

  由于侧链仅提交区块头信息，所以主网无法验证侧链数据的可用性，

  rollup将所有交易和有效性证明提交到主链，主链可以自行验证

- 安全性

  侧链有自己的共识机制和验证者，不依赖主链的，

  rollup依赖主链的共识

# plasma

> 弃用~

plasma是一个提高以太坊可扩展性的框架。该方案运行锚定以太坊的独立区块链，在链下使用乐观rollup仲裁争议。plasma也被称为“子链”，本质是以太坊的较小副本。目的是为了提供以太坊这类公共区块链的可扩展性。



# Polygon

